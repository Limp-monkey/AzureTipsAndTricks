<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Tip 98 - Creating an Email Subscription with Azure Functions - Storing Emails | Azure Tips and Tricks</title>
    <meta name="description" content="">
    <link rel="apple-touch-icon" sizes="57x57" href="/AzureTipsAndTricks/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/AzureTipsAndTricks/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/AzureTipsAndTricks/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/AzureTipsAndTricks/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/AzureTipsAndTricks/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/AzureTipsAndTricks/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/AzureTipsAndTricks/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/AzureTipsAndTricks/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/AzureTipsAndTricks/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/AzureTipsAndTricks/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/AzureTipsAndTricks/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/AzureTipsAndTricks/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/AzureTipsAndTricks/favicon-16x16.png">
  <link rel="manifest" href="/AzureTipsAndTricks/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <script async="true" src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
    
    <link rel="preload" href="/AzureTipsAndTricks/assets/css/0.styles.d2a7f771.css" as="style"><link rel="preload" href="/AzureTipsAndTricks/assets/js/app.6927f979.js" as="script"><link rel="preload" href="/AzureTipsAndTricks/assets/js/4.1e17da4f.js" as="script"><link rel="preload" href="/AzureTipsAndTricks/assets/js/196.1c462013.js" as="script"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/10.8626c325.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/100.264adb54.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/101.5657a47f.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/102.8f92716b.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/103.b0496108.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/104.2d050e9b.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/105.f465a04b.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/106.ba29a28e.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/107.2731df40.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/108.e32be294.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/109.871c50c0.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/11.fa58b6e2.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/110.0746ef1f.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/111.c9dfba11.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/112.85742b1f.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/113.1713f228.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/114.886d751d.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/115.06cfd6de.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/116.31c644c9.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/117.663bebd3.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/118.d90f83e1.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/119.50913b45.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/12.56d042f2.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/120.6cb9c5ae.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/121.ca21c107.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/122.9a354244.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/123.38bdf7cb.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/124.aad3a96c.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/125.a1bb5970.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/126.e3cd9864.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/127.456a4e3a.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/128.17325e03.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/129.b53c7783.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/13.3d447571.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/130.f7bf88af.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/131.b081f8c0.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/132.e07b01c6.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/133.08321cc2.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/134.17ba8270.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/135.e9307f32.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/136.b4bfb09b.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/137.78c53851.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/138.f810750f.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/139.976d6cb1.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/14.8065ad47.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/140.4e7559e0.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/141.ea474bd6.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/142.98f08358.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/143.ce4aed69.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/144.37de0b3e.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/145.f6c47356.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/146.1aef6c01.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/147.14c267c8.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/148.a9864f3d.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/149.0a13a0da.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/15.f8be5aed.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/150.efd0449b.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/151.592a93ca.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/152.2562572b.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/153.48b3b1db.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/154.e6376ce2.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/155.d038806d.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/156.5731e62c.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/157.be45294e.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/158.ef5de263.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/159.1e92229a.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/16.4d41f275.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/160.11e329ec.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/161.87bcbd66.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/162.588c726f.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/163.bc1d790f.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/164.8cb5974a.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/165.fb6b1191.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/166.679d7f17.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/167.19f5410b.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/168.e019ebb8.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/169.45d475fa.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/17.10d72c20.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/170.d9ceb809.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/171.e99f394f.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/172.43241027.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/173.c837f504.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/174.90de003e.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/175.8aa3cdc4.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/176.ac311435.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/177.0a4c31b4.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/178.4a50650b.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/179.bbb1f7f3.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/18.920f0725.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/180.a8cbd901.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/181.90ec9403.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/182.081e9c7c.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/183.867da3ca.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/184.f7b829a3.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/185.e0f8ec34.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/186.f7cac6bd.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/187.6d5aef23.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/188.3fa683be.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/189.50710e0f.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/19.d89bb71c.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/190.f460bc9c.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/191.5b385cea.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/192.004b54f4.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/193.4b60a76f.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/194.4ac8049d.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/195.32182cbb.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/197.d58cf3fd.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/198.0a722daf.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/20.f31cfd81.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/21.82b83f75.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/22.5682c9bb.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/23.ee0a1cda.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/24.8a3681ac.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/25.0c7409c8.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/26.0a85da7a.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/27.3f96c833.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/28.3e541a03.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/29.8106e9a4.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/3.5ca0f648.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/30.f6a75ba8.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/31.5a5cc0eb.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/32.5e5c2357.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/33.fd437a86.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/34.57efcf89.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/35.a569aa43.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/36.f27d2d57.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/37.b83afa93.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/38.209d4ff6.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/39.2ea9d3df.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/40.a25c6751.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/41.fe0a881f.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/42.fba510a5.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/43.4436a00f.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/44.85ca4d82.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/45.dba3d3d2.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/46.167f4042.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/47.f17fc0b5.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/48.6209d530.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/49.e48448f4.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/5.782f2ba2.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/50.7dc0571e.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/51.48869fa1.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/52.ff9f17b7.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/53.7a9f029d.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/54.3fd5d902.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/55.b585af61.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/56.5e2720f2.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/57.df990340.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/58.a4a3d029.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/59.24044274.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/6.f1e92f96.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/60.31a41aae.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/61.0f3675f9.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/62.dca43451.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/63.cf6b995f.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/64.7069a086.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/65.a80d504d.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/66.5da239ba.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/67.a187df63.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/68.80620960.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/69.effae857.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/7.ee00b141.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/70.46b99c4f.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/71.ee537076.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/72.42d184c0.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/73.2e21f332.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/74.3bff8954.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/75.bfe70b1c.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/76.05fe560b.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/77.8b4ff30e.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/78.8f37f8d4.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/79.459d4a0f.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/8.32f391e9.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/80.7dfdeaf8.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/81.4c8d06ed.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/82.55284008.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/83.8fa54d58.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/84.1ccebfae.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/85.bb80944d.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/86.7a725b31.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/87.5749219e.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/88.35f6d6ef.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/89.484e264a.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/9.295e5d94.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/90.db9d4fe7.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/91.0ff6aba8.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/92.abf4d0c2.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/93.1c7f53fe.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/94.33e7546c.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/95.758407df.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/96.a40ff78b.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/97.31ce0b96.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/98.baac2415.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/99.6ce61652.js"><link rel="prefetch" href="/AzureTipsAndTricks/assets/js/vendors~docsearch.9a8918f9.js">
    <link rel="stylesheet" href="/AzureTipsAndTricks/assets/css/0.styles.d2a7f771.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/AzureTipsAndTricks/" class="home-link router-link-active"><img src="/AzureTipsAndTricks/files/vintage.png" alt="Azure Tips and Tricks" class="logo"> <span class="site-name can-hide">Azure Tips and Tricks</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/AzureTipsAndTricks/" class="nav-link">Home</a></div><div class="nav-item"><a href="http://videos.azuredev.tips" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Videos
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="/AzureTipsAndTricks/#site-map" class="nav-link">eBooks</a></div><div class="nav-item"><a href="https://github.com/Microsoft/AzureTipsAndTricks/issues/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Questions?
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://microsoft.github.io/AzureTipsAndTricks/rss.xml" class="nav-link">
  RSS Feed
</a></div> <a href="https://github.com/microsoft/azuretipsandtricks" target="_blank" rel="noopener noreferrer" class="repo-link">
    Star this Repo
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/AzureTipsAndTricks/" class="nav-link">Home</a></div><div class="nav-item"><a href="http://videos.azuredev.tips" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Videos
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="/AzureTipsAndTricks/#site-map" class="nav-link">eBooks</a></div><div class="nav-item"><a href="https://github.com/Microsoft/AzureTipsAndTricks/issues/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Questions?
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://microsoft.github.io/AzureTipsAndTricks/rss.xml" class="nav-link">
  RSS Feed
</a></div> <a href="https://github.com/microsoft/azuretipsandtricks" target="_blank" rel="noopener noreferrer" class="repo-link">
    Star this Repo
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading"><span>Home</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/AzureTipsAndTricks/" class="sidebar-link">Welcome</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>Tips</span> <!----></p> <ul class="sidebar-group-items"></ul></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Recently Added</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>App Service</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Authentication</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>AzCopy</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>CLI</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Cloud Shell</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Cognitive Services</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Containers</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Cosmos DB</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>DevOps</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Front Door</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading open"><span>Functions</span> <span class="arrow down"></span></p> <ul class="sidebar-group-items"><li><a href="/AzureTipsAndTricks/blog/tip35.html" class="sidebar-link">Tip 35 - Work with the Azure Functions File System using the Console</a></li><li><a href="/AzureTipsAndTricks/blog/tip36.html" class="sidebar-link">Tip 36 - Quickly Renew or Revoke Azure Functions Keys</a></li><li><a href="/AzureTipsAndTricks/blog/tip50.html" class="sidebar-link">Tip 50 - Create an Azure Functions project with Visual Studio Code</a></li><li><a href="/AzureTipsAndTricks/blog/tip51.html" class="sidebar-link">Tip 51 - Debug Azure Functions with Visual Studio Code</a></li><li><a href="/AzureTipsAndTricks/blog/tip52.html" class="sidebar-link">Tip 52 - Deploy Azure Functions with Visual Studio Code</a></li><li><a href="/AzureTipsAndTricks/blog/tip61.html" class="sidebar-link">Tip 61 - Java in Azure Function with VS Code</a></li><li><a href="/AzureTipsAndTricks/blog/tip62.html" class="sidebar-link">Tip 62 - Force HTTPS in Azure Functions</a></li><li><a href="/AzureTipsAndTricks/blog/tip63.html" class="sidebar-link">Tip 63 - Open an existing Azure Function in Visual Studio</a></li><li><a href="/AzureTipsAndTricks/blog/tip64.html" class="sidebar-link">Tip 64 - Using a different route prefix with Azure Functions</a></li><li><a href="/AzureTipsAndTricks/blog/tip94.html" class="sidebar-link">Tip 94 - Customize an Azure Functions Endpoint in Seconds</a></li><li><a href="/AzureTipsAndTricks/blog/tip97.html" class="sidebar-link">Tip 97 - Generate a Weekly Digest Email for a Blog using Azure Functions, SendGrid and Azure Storage</a></li><li><a href="/AzureTipsAndTricks/blog/tip98.html" class="active sidebar-link">Tip 98 - Creating an Email Subscription with Azure Functions - Storing Emails</a></li><li><a href="/AzureTipsAndTricks/blog/tip99.html" class="sidebar-link">Tip 99 - Creating an Email Subscription with Azure Functions - Writing the Frontend</a></li><li><a href="/AzureTipsAndTricks/blog/tip100.html" class="sidebar-link">Tip 100 - Creating an Email Subscription with Azure Functions - Sending Emails</a></li><li><a href="/AzureTipsAndTricks/blog/tip130.html" class="sidebar-link">Tip 130 - Manage Application Settings for Azure Functions within Visual Studio</a></li><li><a href="/AzureTipsAndTricks/blog/tip133.html" class="sidebar-link">Tip 133 - Use the Azure Portal for Durable Functions Development</a></li><li><a href="/AzureTipsAndTricks/blog/tip134.html" class="sidebar-link">Tip 134 - Use Run-From-Zip to deploy a site to Azure Web Apps or Functions</a></li><li><a href="/AzureTipsAndTricks/blog/tip135.html" class="sidebar-link">Tip 135 - Use Run-From-Zip without Azure Storage to deploy a site to Azure Web Apps or Functions</a></li><li><a href="/AzureTipsAndTricks/blog/tip136.html" class="sidebar-link">Tip 136 - Quickly Restore your Local Settings File for Azure Functions</a></li><li><a href="/AzureTipsAndTricks/blog/tip147.html" class="sidebar-link">Tip 147 - Run TSQL on an Azure SQL database with Azure Functions</a></li><li><a href="/AzureTipsAndTricks/blog/tip148.html" class="sidebar-link">Tip 148 - Share Business Logic between Azure Functions</a></li><li><a href="/AzureTipsAndTricks/blog/tip157.html" class="sidebar-link">Tip 157 - Part 1 Create Thumbnail Images with Azure Functions and Azure Storage</a></li><li><a href="/AzureTipsAndTricks/blog/tip158.html" class="sidebar-link">Tip 158 - Part 2 Create Thumbnail Images with Azure Functions and Azure Storage</a></li><li><a href="/AzureTipsAndTricks/blog/tip161.html" class="sidebar-link">Tip 161 - Change the Azure Function runtime version after Deployment</a></li></ul></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>HD Insight</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>iOS</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>IoT</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Key Vault</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Logic Apps</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Machine Learning</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Media Services</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Monitor</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Portal</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>PowerShell</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Productivity</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>SAP</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>SDKs</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>SendGrid</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>SignalR</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>SQL</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Storage</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Virtual Machines</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>VNET</span> <span class="arrow right"></span></p> <!----></div></li></ul> </div> <div class="page" data-v-0e4468e2> <div class="content default" data-v-0e4468e2><h4 id="where-are-we"><a href="#where-are-we" aria-hidden="true" class="header-anchor">#</a> Where are we?</h4> <p><strong>Full Source Code</strong> The source code for the app can be found on <a href="https://github.com/mbcrump/EmailSubscription?WT.mc_id=github-azuredevtips-micrum" target="_blank" rel="noopener noreferrer">GitHub<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>This blog post is part of a series on how to generate a weekly digest email for a blog using Azure Functions, SendGrid and Azure Storage.</p> <ul><li><a href="https://microsoft.github.io/AzureTipsAndTricks/blog/tip97.html?WT.mc_id=github-azuredevtips-micrum" target="_blank" rel="noopener noreferrer">Part 1 - What we're going to build and how to build it<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://microsoft.github.io/AzureTipsAndTricks/blog/tip98.html?WT.mc_id=github-azuredevtips-micrum" target="_blank" rel="noopener noreferrer">Part 2 - Storing Emails using Azure Table Storage<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://microsoft.github.io/AzureTipsAndTricks/blog/tip99.html?WT.mc_id=github-azuredevtips-micrum" target="_blank" rel="noopener noreferrer">Part 3 - Writing the Frontend with HTML5 and jQuery<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://microsoft.github.io/AzureTipsAndTricks/blog/tip100.html?WT.mc_id=github-azuredevtips-micrum" target="_blank" rel="noopener noreferrer">Part 4 - Sending Emails with Sendgrid and Azure Functions<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <p>We're trying to build a Email Subscription similar to the following. If you want to catch up, then read the previous post.</p> <img src="/AzureTipsAndTricks/files/emailsub1.png"> <h4 id="continuing-where-we-left-off"><a href="#continuing-where-we-left-off" aria-hidden="true" class="header-anchor">#</a> Continuing where we left off</h4> <p>We recently created a Visual Studio project that used the Azure Functions template. We used NuGet to pull in references to the following packages that we'll be working with shortly:</p> <ul><li>WindowsAzure.Storage <code>To work with Azure Table Storage.</code></li> <li>Microsoft.WindowsAzure.ConfigurationManager <code>To hide our API keys</code></li> <li>Sendgrid <code>To send our emails</code></li> <li>System.ServiceModel.Syndication <code>To work with RSS feeds - use prerelease packages to find it</code></li></ul> <p>Return to the project we created yesterday and right-click the project and select <strong>Add Item</strong> and select <strong>Azure Functions</strong>. Now give it a name such as <strong>StoreEmail</strong> and select <strong>Http Trigger</strong> along with the defaults as shown below.</p> <img src="/AzureTipsAndTricks/files/emailsub6.png"> <p>We only need this to be a <strong>post</strong> request, so modify the <strong>Run</strong> method's signature to match the following :</p> <p><code>[HttpTrigger(AuthorizationLevel.Function, &quot;post&quot;, Route = null)]</code></p> <p><strong>Keep in mind:</strong> You can use <a href="https://docs.microsoft.com/en-us/azure/azure-functions/functions-triggers-bindings?WT.mc_id=docs-azuredevtips-micrum" target="_blank" rel="noopener noreferrer">output bindings<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> to provide a declarative way to connect to data from within your code vs using the code below. Thanks to Matt Honeycutt in the comments.</p> <p>Since we'll be working with Azure Table Storage and I prefer to show you code that you can reuse anywhere, we need to setup a class that has a single field:</p> <ul><li>EmailAddress - to store the email that the user typed in</li></ul> <p>We'll also supply the PartitionKey to be the same every time and use a Guid for our RowKey.</p> <div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code><span class="token keyword">class</span> <span class="token class-name">Email</span> <span class="token punctuation">:</span> <span class="token class-name">TableEntity</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">string</span> EmailAddress <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token function">EmailEntity</span><span class="token punctuation">(</span><span class="token keyword">string</span> email<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        EmailAddress <span class="token operator">=</span> email<span class="token punctuation">;</span>
        PartitionKey <span class="token operator">=</span> <span class="token string">&quot;SendEmailToReaders&quot;</span><span class="token punctuation">;</span>
        RowKey <span class="token operator">=</span> Guid<span class="token punctuation">.</span><span class="token function">NewGuid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token function">EmailEntity</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>I also have a helper class that we'll use to store the data, so add the following which will allow us to pass a table object and a new email instance:</p> <div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code><span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">CreateMessage</span><span class="token punctuation">(</span><span class="token class-name">CloudTable</span> table<span class="token punctuation">,</span> <span class="token class-name">Email</span> newemail<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name">TableOperation</span> insert <span class="token operator">=</span> TableOperation<span class="token punctuation">.</span><span class="token function">Insert</span><span class="token punctuation">(</span>newemail<span class="token punctuation">)</span><span class="token punctuation">;</span>

    table<span class="token punctuation">.</span><span class="token function">Execute</span><span class="token punctuation">(</span>insert<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>Finally, we'll need add the code for the <strong>Run</strong> method:</p> <div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">async</span> Task<span class="token operator">&lt;</span>HttpResponseMessage<span class="token operator">&gt;</span> <span class="token function">Run</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token class-name">HttpTrigger</span><span class="token punctuation">(</span>AuthorizationLevel<span class="token punctuation">.</span>Function<span class="token punctuation">,</span> <span class="token string">&quot;post&quot;</span><span class="token punctuation">,</span> Route <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token class-name">HttpRequestMessage</span> req<span class="token punctuation">,</span> <span class="token class-name">TraceWriter</span> log<span class="token punctuation">)</span>
<span class="token punctuation">{</span>

<span class="token comment">//(Block #1)</span>
    <span class="token keyword">var</span> postData <span class="token operator">=</span> <span class="token keyword">await</span> req<span class="token punctuation">.</span>Content<span class="token punctuation">.</span><span class="token function">ReadAsFormDataAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> missingFields <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token generic-method"><span class="token function">List</span><span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>postData<span class="token punctuation">[</span><span class="token string">&quot;fromEmail&quot;</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        missingFields<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token string">&quot;fromEmail&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>missingFields<span class="token punctuation">.</span><span class="token function">Any</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">var</span> missingFieldsSummary <span class="token operator">=</span> String<span class="token punctuation">.</span><span class="token function">Join</span><span class="token punctuation">(</span><span class="token string">&quot;, &quot;</span><span class="token punctuation">,</span> missingFields<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> req<span class="token punctuation">.</span><span class="token function">CreateResponse</span><span class="token punctuation">(</span>HttpStatusCode<span class="token punctuation">.</span>BadRequest<span class="token punctuation">,</span> $<span class="token string">&quot;Missing field(s): {missingFieldsSummary}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token comment">//(End Block #1)</span>

<span class="token comment">//(Block #2)</span>
    <span class="token keyword">try</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// the line below can be hardcoded if you aren't using AppSettings</span>
        <span class="token class-name">CloudStorageAccount</span> storageAccount <span class="token operator">=</span> CloudStorageAccount<span class="token punctuation">.</span><span class="token function">Parse</span><span class="token punctuation">(</span>ConfigurationManager<span class="token punctuation">.</span>AppSettings<span class="token punctuation">[</span><span class="token string">&quot;TableStorageConnString&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">CloudTableClient</span> tableClient <span class="token operator">=</span> storageAccount<span class="token punctuation">.</span><span class="token function">CreateCloudTableClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">CloudTable</span> table <span class="token operator">=</span> tableClient<span class="token punctuation">.</span><span class="token function">GetTableReference</span><span class="token punctuation">(</span><span class="token string">&quot;MCBlogSubscribers&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        table<span class="token punctuation">.</span><span class="token function">CreateIfNotExists</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token function">CreateMessage</span><span class="token punctuation">(</span>table<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">EmailEntity</span><span class="token punctuation">(</span>postData<span class="token punctuation">[</span><span class="token string">&quot;fromEmail&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> req<span class="token punctuation">.</span><span class="token function">CreateResponse</span><span class="token punctuation">(</span>HttpStatusCode<span class="token punctuation">.</span>OK<span class="token punctuation">,</span> <span class="token string">&quot;Thanks! I've successfully received your request. &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> ex<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> req<span class="token punctuation">.</span><span class="token function">CreateResponse</span><span class="token punctuation">(</span>HttpStatusCode<span class="token punctuation">.</span>InternalServerError<span class="token punctuation">,</span> <span class="token keyword">new</span>
        <span class="token punctuation">{</span>
            status <span class="token operator">=</span> <span class="token keyword">false</span><span class="token punctuation">,</span>
            message <span class="token operator">=</span> $<span class="token string">&quot;There are problems storing your email address: {ex.GetType()}&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token comment">//(End Block #2)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br></div></div><p>Keep in mind, you'll need to pull in your using references for the namespaces we added earlier.</p> <p><strong>Block #1</strong> is all about pulling in the POST data and checking to see if an email address is being sent. If it is, then it will send a summary of what fields are missing.</p> <p><strong>Block #2</strong> tries to save the input via the Azure Table Storage account that we created and if it saves successfully, then returns to the client everything went fine. Otherwise, output to the client what the problem was. Keep in mind, that I'm using <strong>ConfigurationManager</strong> and you can hardcode this value if you please.</p> <p>Hit the Run button in Visual Studio and you'll see the following:</p> <img src="/AzureTipsAndTricks/files/emailsub7.png"> <p>Make note of the localhost where it is running and use something like <strong>Postman</strong> to test your POST call.</p> <p>In the gif below, I've configured Postman to my localhost URL and supplied an email address.</p> <p>I can test the Azure Function by 1) Not supplying anything and 2) Supplying an email address. You'll see the error handling and success messages return to Postman.</p> <img src="/AzureTipsAndTricks/files/emailsub7.gif"></div> <div class="page-edit" data-v-0e4468e2><div class="edit-link" data-v-0e4468e2><a href="https://github.com/microsoft/azuretipsandtricks/edit/master/blog/tip98.md" target="_blank" rel="noopener noreferrer" data-v-0e4468e2>Edit this page on GitHub</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound" data-v-0e4468e2 data-v-0e4468e2><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <section class="share" data-v-0e4468e2><h2 data-v-0e4468e2>Share</h2> <a href="https://twitter.com/intent/tweet?text=Tip 98 - Creating an Email Subscription with Azure Functions - Storing Emails by @mbcrump http://azuredev.tips/blog/tip98.html" target="_blank" class="share__button" data-v-0e4468e2><i class="fab fa-twitter" data-v-0e4468e2></i> Tweet
    </a></section></div> <!----></div> <div class="page-nav" data-v-0e4468e2><p class="inner" data-v-0e4468e2><span class="prev" data-v-0e4468e2>
        ←
        <a href="/AzureTipsAndTricks/blog/tip97.html" class="prev" data-v-0e4468e2>
          Tip 97 - Generate a Weekly Digest Email for a Blog using Azure Functions, SendGrid and Azure Storage
        </a></span> <span class="next" data-v-0e4468e2><a href="/AzureTipsAndTricks/blog/tip99.html" data-v-0e4468e2>
          Tip 99 - Creating an Email Subscription with Azure Functions - Writing the Frontend
        </a>
        →
      </span></p></div> </div> <!----></div><div class="global-ui"></div></div>
    <script src="/AzureTipsAndTricks/assets/js/app.6927f979.js" defer></script><script src="/AzureTipsAndTricks/assets/js/4.1e17da4f.js" defer></script><script src="/AzureTipsAndTricks/assets/js/196.1c462013.js" defer></script>
  </body>
</html>
